@using System.Text.Json;
@using TheRestaurant.Presentation.Client.Pages.Order.OrderDTO;
@using TheRestaurant.Presentation.Shared.OrderDTO;
@using MudBlazor;
@inject ISnackbar Snackbar

@page "/Order"
@inject HttpClient HttpClient

<MudButton Variant="Variant.Text" Color="Color.Primary" @onclick="AddOrderItem">Lägg till i beställning (@orderProductDto.Quantity)</MudButton>
<MudButton Variant="Variant.Text" Color="Color.Primary" @onclick="CreateOrder">Färdigställ beställning(@orderProductDto.Quantity)</MudButton>
@code {
    private OrderDto orderDto = new OrderDto { OrderItems = new List<OrderProductDto>() };

    private OrderProductDto orderProductDto = new OrderProductDto { Id = 1, Quantity = 0 };

    private async Task CreateOrder()
    {
        orderDto.OrderDate = DateTime.Now;
        orderDto.OrderItems.Add(orderProductDto);

        var response = await HttpClient.PostAsJsonAsync("Order", orderDto);

        if (response.IsSuccessStatusCode)
        {
            // Parse the response data
            var responseData = await response.Content.ReadAsStringAsync();

            // Deserialize the response data into an OrderDto object
            var order = JsonSerializer.Deserialize<OrderDto>(responseData);

            // Response to user
            Snackbar.Add("Order " + order.Id + " was successfully created.");
        }

        else
        {
            // TODO code to handle an unsuccessful order
        }
    }

    private async Task GetOrder(int id)
    {
        var response = await HttpClient.GetAsync($"api/order/{id}");

        if (response.IsSuccessStatusCode)
        {
            var responseData = await response.Content.ReadAsStringAsync();
            var order = JsonSerializer.Deserialize<OrderDto>(responseData);
            // Do something with the order...
        }
        else
        {
            // Handle the error...
        }
    }



    private void AddOrderItem()
    {
        orderProductDto.Quantity++;
    }
}
