@using MudBlazor
@using TheRestaurant.Presentation.Client.ClientServices
@inject RoleService RoleService
@inject ServerAuthenticationStateProvider AuthState

@if (HasPermission)
{
    <MudMenu Icon="@Icons.Material.Filled.Settings" Color="Color.Primary">
        <MudMenuItem>
            <MudNavLink href="/Admin/Index">
                Admin
            </MudNavLink>
        </MudMenuItem>

        <MudMenuItem>
            <MudNavLink href="/register">
                Registrering
            </MudNavLink>
        </MudMenuItem>
    </MudMenu>
}

@code {
    private bool HasPermission => IsAdmin || IsManager;
    private bool IsAdmin;
    private bool IsManager;

    [CascadingParameter] private Task<AuthenticationState> authenticationStateTask { get; set; }

    protected override async Task OnInitializedAsync()
    {
        await UpdateSuccessState();
    }

    private async Task UpdateSuccessState()
    {
        if (authenticationStateTask != null)
        {
            var user = await AuthState.GetAuthenticationStateAsync();

            IsAdmin = user.User.IsInRole("admin");
            IsManager = user.User.IsInRole("manager");
            // Trigger a re-render
            StateHasChanged();
        }
    }
}